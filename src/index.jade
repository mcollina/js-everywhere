doctype html
html
  head
    meta(charset='utf-8')
    meta(name='viewport', content='width=device-width, initial-scale=1, maximum-scale=1')
    title JS Everywhere

    link(rel='stylesheet', type='text/css', href='build/build.css')

  body

    #broker-stats

    article

      section(data-bespoke-backdrop="crane").transwhite
        a(href="http://nearform.com" style="width: 200px")
          img(src="./images/nearform.svg")
        h1 JS Everywhere
        h2 by&nbsp;
          a(href="http://twitter.com/matteocollina") Matteo Collina

      section
        h2(style="margin-left: -100px")
          | This&nbsp;
          span.blink blink
          | &nbsp;like it's 1998

      section
        h2 what js is&nbsp;
          span.blink good
          | &nbsp;for
        pre
          code.language-javascript.
            if (el.style.visibility === 'hidden') {
              el.style.visibility = 'visible'
            } else {
              el.style.visibility = 'hidden'
            }

      section
        img(src="images/jquery.svg" style="width: 90%")

      section(data-bespoke-backdrop="node").trans

      section
        h2 Flow control is built-in
        h3 If applications sends too much data,
         | we can slow them down with backpressure!
        pre
          code.language-javascript.
            function process(data, cb) {
              /* oh yeah, we are processing one
                 thing at a time
                 or we can do batches! */
              setTimeout(cb, 500)
            }

      section
        h2 Node.js has streams too!
        pre
          code.language-javascript.
            source.pipe(dest).pipe(source)

      section
        h2 Microservices
        ul.bullet
          li AWS Lambda
          li Netflix
          li Uber
          li ... and many others!

      section
        a(href="http://senecajs.org" style="width: 100%")
          img(src="./images/seneca.svg")

      section
        img(src='images/npm.svg' style="height: 50%")
        h2 The best community ever
        h3 we love you too, npm

      section
        img(src="images/grunt.png" style="height: 90%")

      section
        img(src="images/gulp.svg" style="height: 90%")

      section(data-bespoke-backdrop="react").trans
        img(src="images/react.svg" style="height: 90%")

      section
        pre
          code.language-javascript.
            var HelloMessage = React.createClass({
              render: function() {
                return <div>Hello {this.props.name}</div>;
              }
            });

            ReactDOM.render(&lt;HelloMessage name="John" />, mountNode);

      section
        h1 NodeBots
        .nodebot
          .icon
            .bobble
            .antenna
            .head
              div(class="eye left")
              div(class="eye right")
            .neck
            .neck
        .copyright Credits
          a(href="http://github.com/nodebots") &nbsp;http://github.com/nodebots

      section
        img(src="images/equation.png")
        .copyright Credits
          a(href="http://github.com/nodebots") &nbsp;http://github.com/nodebots

      section(data-bespoke-backdrop="arduino").trans

      section
        img(src="images/johnny-five.png" style="height: 80%")

      section
        h2 Johnny Five
        pre
          code.language-javascript.
            var five = require("johnny-five")
            var board = new five.Board()

            board.on('ready', function () {
              /* Create an Led on pin 13 */
              var led = new five.Led(13)
              /* Blink every half second */
              led.blink(500)
            })

      section(data-bespoke-backdrop="raspi").trans

      section(data-bespoke-backdrop="tessel2").trans

      section(data-bespoke-backdrop="edison").trans

      section(data-camera="fullscreen")
        h1 You should not see this!

      section
        h2 Universal JS
        img(src="images/js.png" style="height: 50%")
        ul.bullet
          li use the same libraries in
           | browsers, servers, and devices
          li simple architecture, fewer components
          li can we use all of this to build an IoT system?

      section(data-bespoke-backdrop="crane").trans
        h2(style="margin-left: -100px") An IoT system

      section(data-bespoke-backdrop="politie").trans
        h2(style="margin-left: -100px; color: white;") Another IoT system

      section(data-bespoke-backdrop="office").trans
        h2(style="margin-left: -100px; margin-bottom: -250px; color: white;") One more IoT system

      section(data-bespoke-backdrop="earth").trans
        h2(style="margin-left: -100px; margin-bottom: -250px; color: white;")
          | The world is our playground..

      section(data-bespoke-backdrop="earth").trans
        h2(style="margin-left: -100px; margin-bottom: -250px; color: white;")
          | ..for now :)

      section
        h2 What is an IoT system?
        br
        img(src='images/overview.png' style="height: 90%")

      section
        h2 Architecture
        img(src='images/puzzle.png' style="height: 90%")

      section
        h2 Sensor Data Flow
        img(src='images/sensor data.png' style="height: 90%")

      section
        h2 Commands Flow
        img(src='images/commands.png' style="height: 90%")

      section
        img(src='images/data flow.png' style="height: 90%")

      section
        h2 Problems
        ul.bullet
          li Latency
          li no reuse
          li complex
          li lots of moving parts

      section
        h2 Using a pub/sub broker

      section
        h2 Sensor Data Flow
        img(src='images/pubsub-sensordata.png' style="height: 90%")

      section
        h2 Commands Flow
        img(src='images/pubsub-commands.png' style="height: 90%")

      section.full-imgs
        img(src="images/mqttorg.svg")

      section(data-bespoke-backdrop="node").trans

      section
        img(src='images/MQTT.js.png' style="height: 60%")

      section
        h2 MQTT.js works on
        ul.bullet
          li browsers
          li servers
          li devices

      section
        h2 MQTT
        ul
          li publish/subscribe protocol
          li multiple quality of service level..
          li ..with at-least-once and exactly-once semantics
          li low overhead (2 bytes at minimum)
          li offline messaging
          li retained messages, like a key/value store
          li can run over WebSocket

      section
        h2 Publish-Subscribe
        img(src="images/pubsub.png", style="height: 100%")

      section
        img(src="images/mosca.png")
        br
        h3 MQTT broker in Node.js

      section
        h2 Mosca
        ul
          li
            a(href="http://npm.im/mosca") http://npm.im/mosca
          li Standalone usage, through `$ mosca`
          li Embeddable in your app, so you can do X for every message
          li Authentication APIs
          li Supports Mongo, Redis, AMQP, and MQTT as pub/sub backends
          li Needs a DB, such as LevelDB, Mongo, or Redis
          li Support websockets
          li Test instance available at test.mosca.io
          li New version coming with 10x throughput improvement

      section
        h2 Authentication in Mosca

        pre
          code.language-javascript.
            var server = new mosca.Server(settings);
            /* Accepts the connection if the username
               and password are valid */
            function authClient(client, user, pass, cb) {
              var authorized = (
                user=== 'alice' &&
                pass.toString() == 'secret' );
              if (authorized) client.user = user;
              callback(null, authorized);
            }
            server.authenticate = authClient;

      section
        h2 Publish Authorization in Mosca

        pre
          code.language-javascript.
            var server = new mosca.Server(settings);
            function authPub(client, topic, payload, cb) {
              var ok = client.user == topic.split('/')[1];
              /* we can alter the message here */
              if (ok) callback(null, payload);
              else callback(null, false);
            }
            server.authorizePublish = authPub;

      section
        h2 Subscribe Authorization in Mosca

        pre
          code.language-javascript.
            var server = new mosca.Server(settings);
            function authSub(client, topic, cb) {
              var ok = client.user === topic.split('/')[1];
              cb(null, ok);
            }
            server.authorizeSubscribe = authSub;

      section
        h2 Storing data in a timeseries

        pre
          code.language-javascript.
            var server = new mosca.Server(settings);

            function published(packet, client, callback) {
              timeseries.store(packet, callback);
            }
            server.published = published;

      section
        a(href="http://senecajs.org" style="width: 100%")
          img(src="./images/seneca.svg")
        h3
          a(href="http://senecajs.org" style="width: 100%").
            http://senecajs.org

      section
        pre
          code.language-javascript.
            var seneca = require('seneca')()
            seneca.add({
              role:'user',
              cmd:'login'
            }, function (args, callback) {
              var loggedIn = args.username === 'matteo' &&
                             args.password === 'collina'
              callback(null, { loggedIn:loggedIn })
            })
            seneca.listen()

      section
        pre
          code.language-javascript.
            var seneca = require('seneca')()
            var client = seneca.client()
            client.act({
              role:'user',
              cmd:'login',
              username: 'matteo',
              password: 'collina'
            }, function (err, result) {
              console.log(result.loggedIn)
            })

      section
        h3
          img(src="./images/seneca.svg" style="width: 20%; margin-top 30%;")
          br
          | Features
        ul.bullet
          li multiple transports, from bare TCP to busses
          li build a monolith, and then split it away
          li deep inspection & debugging tools
          li authentication/user managament system
          li control panel
          li integration with HAPI
          li gossip-based service discovery

      section
        h2 Demo: an IoT system
        ul.bullet
          li microservice based
          li on top of MQTT
          li service discovery based on gossip

      section
        img(src='images/iot-system.png' style="height: 90%")

      section
        img(src='images/fuge.png' style="width: 90%")

      section
        h2 Demo!
        p
          a(href="https://github.com/nearform/iot-system").
            https://github.com/nearform/iot-system

      section
        h2 Links
        ul.bullet(style="text-align: left")
          li(style="text-align: left")
            b MQTT.js:&nbsp;
            a(href="http://npm.im/mqtt") http://npm.im/mqtt
          li(style="text-align: left")
            b Mosca:&nbsp;
            a(href="http://mosca.io/") http://mosca.io
          li(style="text-align: left")
            b Seneca:&nbsp;
            a(href="http://senecajs.org/") http://senecajs.org/
          li(style="text-align: left")
            b Fuge:&nbsp;
            a(href="http://fuge.io") http://fuge.io
          li(style="text-align: left")
            b Vidi:&nbsp;
            a(href="https://github.com/vidi-insights/vidi-dashboard") https://github.com/vidi-insights/vidi-dashboard
          li(style="text-align: left")
            b seneca-mesh:&nbsp;
            a(href="http://npm.im/seneca-mesh")  http://npm.im/seneca-mesh
          li(style="text-align: left")
            b toolbag:&nbsp;
            a(href="http://npm.im/toolbag") http://npm.im/toolbag
          li(style="text-align: left")
            b swim-js:&nbsp;
            a(href="http://npm.im/swim-js") http://npm.im/swim-js
          li(style="text-align: left")
            b baseswim:&nbsp;
            a(href="http://npm.im/baseswim") http://npm.im/baseswim

      section
        h2 This presentation
        ul
          li(style="text-align: left")
            a(href="https://github.com/mcollina/js-everywhere").
              https://github.com/mcollina/js-everywhere
          li(style="text-align: left")
            a(href="https://mcollina.github.io/js-everywhere").
              https://mcollina.github.io/js-everywhere
          li(style="text-align: left")
            a(href="https://github.com/nearform/iot-system").
              https://github.com/nearform/iot-system

      section.full-imgs
        img(src='images/me.png')

      section.full-imgs
        img(src='images/nearform.svg')

      section
        h1 Thanks!
        br
        p If you need help with Node
        p or the Internet of Things
        br
        h3 <a href="mailto:matteo.collina@nearform.com">matteo.collina@nearform.com</a>
        h3 <a href="http://twitter.com/matteocollina">@matteocollina</a> on Twitter
        h3 <a href="http://www.nearform.com">www.nearform.com</a>

    script(src='build/build.js')
